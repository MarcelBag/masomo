{% extends "base.html" %}
{% load static %}

{% block title %}Subjects{% endblock %}
{% block header_title %}Subjects{% endblock %}

{% block content %}

<!-- ========== Search / Filters ===================================== -->
<form class="subject-search" method="get">
    <input  type="text" name="q" placeholder="Search subject or codeâ€¦"
            value="{{ q|default_if_none:'' }}">
  
    <select name="class">
        <option value="">All classes</option>
        {% for c in class_choices %}
          <option value="{{ c.id }}"
            {% if c.id|stringformat:"s" == cls %}selected{% endif %}>
            {{ c.name }}
          </option>
        {% endfor %}
    </select>
  
    <select name="teacher">
        <option value="">All teachers</option>
        {% for t in teacher_choices %}
          <option value="{{ t.id }}"
            {% if t.id|stringformat:"s" == t_id %}selected{% endif %}>
            {{ t.first_name }} {{ t.last_name }}
          </option>
        {% endfor %}
    </select>
  
    <button type="submit">Filter</button>
  </form>
  
  <!-- ========== Subject list ========================================= -->
  {% if subjects %}
    <ul class="subject-list">
      {% for s in subjects %}
        <li class="subject-row">
           <span class="code">{{ s.code }}</span>
           <span class="name">{{ s.name }}</span>
           <span class="class">{{ s.school_class.name }}</span>
           <span class="teacher">
               {{ s.teacher.first_name }} {{ s.teacher.last_name }}
           </span>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="empty-msg">No subjects found.</p>
  {% endif %}

<!-- ---------- quick-add form ----------------------------------------- -->
<h2 class="section-title">Add a subject</h2>
<form method="post" class="class-form">
  {% csrf_token %}
  {{ form.non_field_errors }}

  <div class="form-grid">
    <div>
      {{ form.name.label_tag }}{{ form.name }}
      {{ form.name.errors }}
    </div>

    <div>
      {{ form.code.label_tag }}{{ form.code }}
      {{ form.code.errors }}
    </div>

    <div>
      {{ form.school_class.label_tag }}{{ form.school_class }}
      {{ form.school_class.errors }}
    </div>

    <div>
      {{ form.teacher.label_tag }}{{ form.teacher }}
      {{ form.teacher.errors }}
    </div>
  </div>

  <button type="submit" class="btn-primary">Save</button>
</form>

{% endblock %}
